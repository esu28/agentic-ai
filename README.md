<pre markdown> ```mermaid flowchart LR %% Subgraph for Inputs subgraph Inputs style Inputs fill:#f0f8ff,stroke:#666,stroke-width:2px A1([Histology Image]):::input A2([ST Gene Matrix]):::input A3([LRP Database]):::input A4([TF Activity Scores]):::input end %% Preprocessing subgraph Preprocessing style Preprocessing fill:#fff8dc,stroke:#666,stroke-width:2px B1([Map spots → histology patches]):::process B2([Filter & Normalize Genes]):::process B3([Standardize Patches]):::process end %% Feature Extraction subgraph FeatureExtraction style FeatureExtraction fill:#e6ffe6,stroke:#666,stroke-width:2px C1([DWT Texture on ST & Histo]):::process C2([Compute Local Stats]):::process C3([Mutual Information & Coexpr]):::process C4([Primary CCC Scores]):::process end %% Graph Construction subgraph GraphConstruction style GraphConstruction fill:#fff0f5,stroke:#666,stroke-width:2px D1([Build Radius Graph]):::process D2([Compute Edge Features]):::process D3([Edge Gating Layer]):::process end %% Encoder & Clustering subgraph EncoderAndClustering style EncoderAndClustering fill:#f5f5dc,stroke:#666,stroke-width:2px E1([Graph Transformer w/ Attention]):::process E2([Learn Embeddings Z & LRP Weights γ]):::process E3([Select Top LRPs (Kneedle)]):::process E4([Cluster Embeddings → Niches]):::process end %% Downstream Analysis subgraph Analysis style Analysis fill:#e0ffff,stroke:#666,stroke-width:2px F1([Marker-Gene Enrichment]):::analysis F2([Niche-Specific CCC Tests]):::analysis F3([Morphology Validation]):::analysis F4([Spatial Coherence Tests]):::analysis end %% Connect the dots A1 & A2 & A3 & A4 --> B1 B1 --> B2 --> B3 --> C1 C1 --> C2 --> C3 --> C4 --> D1 D1 --> D2 --> D3 --> E1 E1 --> E2 --> E3 --> E4 --> F1 F1 --> F2 --> F3 --> F4 %% Styling classDef input fill:#d1ecf1,stroke:#0c5460,stroke-width:1px,rx:5,ry:5 classDef process fill:#fff3cd,stroke:#856404,stroke-width:1px,rx:5,ry:5 classDef analysis fill:#d4edda,stroke:#155724,stroke-width:1px,rx:5,ry:5 ``` </pre>
